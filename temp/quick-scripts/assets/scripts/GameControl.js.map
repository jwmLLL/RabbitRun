{"version":3,"sources":["GameControl.js"],"names":["PropEnum","require","Config","cc","Class","extends","Component","properties","bgNode","default","type","Node","playerNode","gameOver","start","bgMove","getComponent","player","active","startUpdate","totalScore","everyStep","schedule","updateCollision","bind","initProp","btnClickEvent","event","customData","startMove","rabbitJump","len1","propArr","length","len2","i","j","item","rabbit","getBoundingBoxToWorld","intersects","judgeCollision","tag","parseInt","name","UtilTool","log","stone","wood","rottenWood","gameResult","null","unscheduleAllCallbacks","label_score","string"],"mappings":"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","file":"GameControl.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["import UtilTool from \"./util/UtilTool\";\n\nconst PropEnum = require(\"PropEnum\");\nconst Config = require(\"Config\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        bgNode: {\n            default: null,\n            type: cc.Node\n        },\n        playerNode: {\n            default: null,\n            type: cc.Node\n        },\n        gameOver: {\n            default: null,\n            type: cc.Node\n        }\n\n    },\n\n    start() {\n        this.bgMove = this.bgNode.getComponent(\"BgView\");\n        this.player = this.playerNode.getComponent(\"Player\");\n\n        this.gameOver.active = false;\n\n    },\n\n    startUpdate() {\n        Config.totalScore = 0;\n        this.everyStep = 0;\n        this.schedule(this.updateCollision.bind(this), 0.4);\n        this.bgMove.initProp();\n    },\n\n\n    btnClickEvent: function (event, customData) {\n        // console.log(\" GameControl customData : \" + customData);\n        switch (customData) {\n            case 'jump_1':\n                this.bgMove.startMove(1);\n                this.everyStep = 1;\n                break;\n            case 'jump_2':\n                this.bgMove.startMove(2);\n                this.everyStep = 2;\n                break;\n        }\n        this.player.rabbitJump(1);\n        Config.totalScore += this.everyStep;\n        // return new Promise(function (resolve,reject) {\n        //     if (true){\n        //         resolve(value);\n        //     }else {\n        //         reject(value);\n        //     }\n        // })\n    },\n\n    updateCollision() {\n        let len1 = this.bgMove.propArr.length;\n        let len2 = this.bgMove.propArr[0].length;\n\n        for (let i = 0; i < len1; i++) {\n            for (let j = 0; j < len2; j++) {\n                let item = this.bgMove.propArr[i][j];\n                if (this.player.rabbit.getBoundingBoxToWorld().intersects(item.getBoundingBoxToWorld())) {\n                    // UtilTool.log(\" item 22222   tag  : \" + item.name);\n                    this.judgeCollision(item);\n                }\n            }\n        }\n    },\n\n    judgeCollision(item) {\n        let tag = parseInt(item.name);\n        UtilTool.log(\"PropEnum.stone  \" + PropEnum.stone)\n        switch (tag) {\n            case PropEnum.stone:\n\n                break;\n            case PropEnum.wood:\n\n                break;\n            case PropEnum.rottenWood:\n                UtilTool.log(\"碰到朽木\");\n                this.gameResult();\n                break;\n            case PropEnum.null:\n                UtilTool.log(\"碰到空的\");\n                this.gameResult();\n                break;\n        }\n    },\n\n    gameResult() {\n        this.unscheduleAllCallbacks();\n\n        Config.totalScore -= this.everyStep;\n        this.gameOver.getComponent(\"GameOver\").label_score.string = \"\" + Config.totalScore;\n        this.gameOver.active = true;\n    }\n});\n"]}